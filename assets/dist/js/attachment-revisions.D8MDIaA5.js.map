{"version":3,"file":"attachment-revisions.D8MDIaA5.js","sources":["../../../source/js/attachment-revisions.js"],"sourcesContent":["var AttatchmentRevisions = {};\nvar AttachmentRevisions = AttachmentRevisions || {};\nAttachmentRevisions.MediaUpload = (($) => {\n\tvar _fileUploader = null;\n\tvar _shouldDeleteAttachment = true;\n\n\tfunction MediaUpload() {\n\t\tthis.handleEvents();\n\t}\n\n\tMediaUpload.prototype.handleEvents = function () {\n\t\t// Replace media button\n\t\t$(document).on(\n\t\t\t'click',\n\t\t\t'[data-action=\"media-replacer-replace\"]',\n\t\t\tfunction (e) {\n\t\t\t\tthis.openFileUploader(e.target);\n\t\t\t}.bind(this),\n\t\t);\n\n\t\t// Revisions button\n\t\t$(document).on('click', '[data-action=\"media-replacer-revisions\"]', function (e) {\n\t\t\tif ($(this).parents('.media-modal').length) {\n\t\t\t\tlocation.href = $(this).data('edit-link');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\t// New Image button\n\t\t$(document).on('click', '.media-button-new', (e) => {\n\t\t\t$('.uploader-inline-content').show();\n\t\t\t$('.attachment-details.save-ready').hide();\n\t\t\t$('.media-toolbar-primary .media-button-new').remove();\n\t\t});\n\n\t\t$(document).on('click', '.media-replace-revisions [data-restore]', function (e) {\n\t\t\tif ($(this).hasClass('selected')) {\n\t\t\t\t$('[name=\"media-replace-restore\"]').val('');\n\t\t\t\t$(this).removeClass('selected');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$('.media-replace-revisions li.selected').removeClass('selected');\n\n\t\t\tvar path = $(this).data('restore');\n\t\t\t$('[name=\"media-replace-restore\"]').val(path);\n\t\t\t$(this).addClass('selected');\n\t\t\treturn;\n\t\t});\n\n\t\t$('[data-action=\"media-replace-close-thickbox\"]').on('click', () => {\n\t\t\t$('#TB_closeWindowButton').trigger('click');\n\t\t});\n\t};\n\n\tMediaUpload.prototype.openFileUploader = function (element) {\n\t\t//$('.uploader-inline-content').show();\n\t\t// If opened from media modal redirect to edit post page\n\t\tif ($(element).parents('.media-modal').length) {\n\t\t\tlocation.href = $(element).closest('[data-edit-link]').data('edit-link');\n\t\t\treturn;\n\t\t}\n\n\t\tif (_fileUploader) {\n\t\t\t// Open the modal\n\t\t\t_fileUploader.open();\n\n\t\t\t// Default to upload file tab\n\t\t\t$('.media-router a:first-of-type').trigger('click');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setupFileUploader();\n\t};\n\n\tMediaUpload.prototype.setupFileUploader = function () {\n\t\tvar query = wp.media.query({\n\t\t\torderby: 'date',\n\t\t\tquery: true,\n\t\t\tuploadedTo: -1,\n\t\t});\n\n\t\t_fileUploader = wp.media({\n\t\t\ttitle: 'Select replacement file',\n\t\t\tbutton: {\n\t\t\t\ttext: mediaReplacer.replace,\n\t\t\t},\n\t\t\tmultiple: false,\n\t\t\tstates: [\n\t\t\t\tnew wp.media.controller.Library({\n\t\t\t\t\tlibrary: query,\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\twp.Uploader.queue.on('reset', () => {\n\t\t\t$('.uploader-inline-content').hide();\n\t\t\t$('.media-toolbar-primary').prepend(\n\t\t\t\t'<button type=\"button\" class=\"button media-button' +\n\t\t\t\t\t' button-primary button-large media-button-new\">' +\n\t\t\t\t\tmediaReplacer.newImage +\n\t\t\t\t\t'</button>',\n\t\t\t);\n\t\t});\n\n\t\t_fileUploader.on('select', () => {\n\t\t\tvar selected = _fileUploader.state().get('selection').first().toJSON().id;\n\t\t\tif (typeof selected != 'undefined') {\n\t\t\t\t_shouldDeleteAttachment = false;\n\t\t\t\t$('[name=\"media-replacer-replace-with\"]').val(selected).closest('form').submit();\n\t\t\t} else {\n\t\t\t\talert('You did not select a file. Media will not be replaced.');\n\t\t\t}\n\t\t});\n\n\t\t_fileUploader.on('close', () => {\n\t\t\tvar selected = null;\n\n\t\t\tif (typeof _fileUploader.state().get('selection').first() != 'undefined') {\n\t\t\t\tselected = _fileUploader.state().get('selection').first().toJSON().id;\n\t\t\t}\n\n\t\t\tif (!selected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!_shouldDeleteAttachment) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t$.post(ajaxurl, { action: 'attachment_revisions_remove_attachment', id: selected }, (response) => {\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\n\t\tthis.openFileUploader();\n\t};\n\n\treturn new MediaUpload();\n})(jQuery);\n"],"names":[],"mappings":"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"}