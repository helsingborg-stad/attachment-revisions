var AttatchmentRevisions={},AttachmentRevisions=AttachmentRevisions||{};AttachmentRevisions.MediaUpload=function(e){function t(){this.handleEvents()}var i=null,a=!0;return t.prototype.handleEvents=function(){e(document).on("click",'[data-action="media-replacer-replace"]',function(e){this.openFileUploader(e.target)}.bind(this)),e(document).on("click",'[data-action="media-replacer-revisions"]',function(t){if(e(this).parents(".media-modal").length)return location.href=e(this).data("edit-link"),!1}),e(document).on("click",".media-replace-revisions [data-restore]",function(t){if(e(this).hasClass("selected"))return e('[name="media-replace-restore"]').val(""),void e(this).removeClass("selected");e(".media-replace-revisions li.selected").removeClass("selected");var i=e(this).data("restore");e('[name="media-replace-restore"]').val(i),e(this).addClass("selected")})},t.prototype.openFileUploader=function(t){return e(t).parents(".media-modal").length?void(location.href=e(t).closest("[data-edit-link]").data("edit-link")):i?(i.open(),void e(".media-router a:first-of-type").trigger("click")):void this.setupFileUploader()},t.prototype.setupFileUploader=function(){var t=wp.media.query({orderby:"date",query:!0,uploadedTo:-1});i=wp.media({title:"Select replacement file",button:{text:"Replace"},multiple:!1,states:[new wp.media.controller.Library({library:t})]}),i.on("select",function(){var t=i.state().get("selection").first().toJSON().id;"undefined"!=typeof t?(a=!1,e('[name="media-replacer-replace-with"]').val(t).closest("form").submit()):alert("You did not select a file. Media will not be replaced.")}),i.on("close",function(){var t=null;"undefined"!=typeof i.state().get("selection").first()&&(t=i.state().get("selection").first().toJSON().id),t&&setTimeout(function(){return!!a&&void e.post(ajaxurl,{action:"attachment_revisions_remove_attachment",id:t},function(e){console.log(e)})},1e3)}),this.openFileUploader()},new t}(jQuery);